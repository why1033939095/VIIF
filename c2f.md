* Coarse to Fine 粗匹配到精细匹配，基于图像的轮廓特征，可以提供准确的主方向用以提取描述符，增加特征点主方向的相似性来解决光谱和视点的差异问题。因为轮廓特征在红外图和可见光图中总是突出的。C2F通过全局优化匹配点的位置解决，获得准确的图像变换矩阵。充分利用图像轮廓特征精确配准方法。
* 视点差异不变性，主方向分配
* 频谱和空间梯度是不同的，现有方法依赖于单模态图像之间的空间梯度相似性。
> 1. 图像边缘采用边缘检测器提取，采用Canny检测器
> 2. 利用遍历搜索方法得到边缘图中的每个轮廓  
s是轮廓的集合，Γ是轮廓（点集中有n个点），P是单个点（x,y坐标），每个轮廓有两个辅助点  
f是2到n-1，是轮廓中的***特征点***（其实就是把轮廓分成几段），λL和λR是点P的采样长度，辅助点是通过归一化的高斯函数和点坐标进行矩阵乘法得到的结果。  
找出轮廓上特征点左右的最近局部最小曲率的两个点 $λ_L=f-kL$  
如果f在轮廓首和尾部，一侧辅助点就是本身，另一侧再用高斯矩阵进行矩阵乘法  
这样保证了红外和可见光图像中相同特征点采样领域的一致性，实现了图像旋转和视点的不变性  
> 3. 轮廓的两个辅助点和轮廓的特征点可以形成一个特征三角形。指定对应于顶点的角平分线作为特征点的主方向，也成为轮廓角的方向。所有的方向的角度都在0-2Π  
> 4. 分辨率的差异，使对应的匹配点之间存在定位误差。  
粗匹配：旋转角估计和连线一致性理论  
旋转角估计：通过***双边匹配方法***。旋转角近似是匹配上的两个主方向之差（主方向有偏差），错误的匹配的旋转角会显著偏离实际值。旋转角用直方图表示出来，间距太小会导致直方图出现多个峰，过大会导致精度降低，推荐使用6°。使用抛物线插值方法于峰值和离峰值最近的两个值，计算旋转角的估计值。  
连线一致性：将红外图像与经过旋转和尺度变换后的可见光图像进行水平拼接，正确匹配的连接线理论上是等长的且彼此平行。反之错误匹配的连接线长度和倾斜角度不同。  
将红外和可见光调整到相同垂直分辨率时，图像中相同区域的像素面积比，然后通过这个比例和旋转角将P2转成和P1相同的尺度和方向。把红外和可见光横着排列起来，可见光图在右，计算出两点之间的距离和倾斜角，倾斜角可以通过与旋转角相同的直方图方法获得，取值范围-90到90°之间。由于存在误差，使用误差阈值ε去除区间之外的倾斜角度对应的匹配，用εd作为长度比误差阈值，Dm是剩余匹配的平均长度并且接近正确匹配之间的连线长度。推荐ε为15°，εd推荐为0.5  
粗匹配：选择随机样本一致性算法，通过数百次迭代来去除剩余的少量错误匹配。少于通常数千次迭代，因为明显的错误匹配被去除。  
>       * 随机抽样一致（RANSAC）是一种通过使用观测到的数据点来估计数学模型参数的迭代方法，一定概率下得到一个合理的结果。分内点和外点，内点是有效的，外点无效。
>
>    精细匹配：粗匹配后，已经得到正确的对应匹配点，由于成像分辨率和质量的差异，存在许多在子像素或像素级具有位置偏差的匹配。提出基于全局迭代优化的精细匹配方法，减小特征点的位置偏差。用最小二乘法计算投影矩阵，[最小二乘法矩阵解法](https://zhuanlan.zhihu.com/p/149280713)  
残差最大的拟合点是通过大量实验观测而接近正确位置的最有可能的点。残差被升序排序后，找到最后1/4的点，然后Pc2中对应于最后四分之一的点被拟合点替换掉。一直更新Pc2中的点，直到残差的总和约等于0，其目的是更新Pc2中的所有点，在通过精细匹配全局优化之后，Pc2的位置被更新，明显位置误差的匹配被调整以矫正位置，最后得到投影变换矩阵。
>


检测点，然后把点0连接起来，不断清零，直到把所有点都清成零，边上的点大于图像长+宽/60
